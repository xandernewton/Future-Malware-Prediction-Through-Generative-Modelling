import os

import torch
from torch.utils.data import random_split, DataLoader
from torchvision import datasets
from torchvision.transforms import transforms


def get_loaders(data_dir, batch_size, split=0.9):
    transform = transforms.Compose([
        transforms.Resize((32,32)),
        transforms.ToTensor(),
        transforms.Normalize((.5, .5, .5),
                             (.5, .5, .5))
    ])

    dataset = datasets.ImageFolder(root=data_dir, transform=transform)
    train_size = int(0.8 * len(dataset))
    test_size = len(dataset) - train_size
    malware_train, malware_val = random_split(dataset, [train_size, test_size])
    train_dataset = malware_train
    val_dataset = malware_val

    train_loader = DataLoader(
        train_dataset,
        batch_size=batch_size,
        shuffle=True,
        num_workers=0)

    val_loader = DataLoader(
        val_dataset,
        batch_size=batch_size,
        num_workers=0)

    return train_loader, val_loader
